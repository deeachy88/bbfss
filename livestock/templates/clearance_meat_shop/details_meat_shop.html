{% for file_attach in file_attach %}
    <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <label>Scope</label>
                <div class="form-check" id="scope">
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="scope" value="Retail Meat Shop">
                      <label class="form-check-label">Retail Meat Shop</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="scope" value="Wholesale">
                        <label class="form-check-label">Whole Sale</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="scope" value="Cold Storage">
                        <label class="form-check-label">Cold Storage</label>
                    </div>
                </div>
            <div class="alert alert-danger" id="scopeErrorMsg" style="display:none"></div>
          </div>
        </div>
        <div class="col-md-6">
           <div class="form-group">
            <label>Purpose</label>
                <div class="form-check" id="purpose">
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="purpose"  value="Conditional Clearance">
                      <label class="form-check-label" >Conditional Clearance</label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="purpose" value="Operation of Meat Shop">
                      <label class="form-check-label" >Operation of Meat Shop</label>
                    </div>
                </div>
                <div class="alert alert-danger" id="purposeErrorMsg" style="display:none"></div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <div class="form-group">
                <label >Name of the Meat Shop</label>
                <input type="text" class="form-control" id="shopName" name="shopName" value="{{application_details.Name_Meat_Shop}}">
            </div>
            <div class="alert alert-danger" id="shopNameErrorMsg" style="display:none"></div>
        </div>
        <div class="col-md-6">
            <div class="form-group">
            <label>Ownership Type</label>
                <div class="form-check" id="ownership">
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="ownership" value="Government">
                      <label class="form-check-label" >Government</label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="ownership" value="Private">
                      <label class="form-check-label" >Private</label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="ownership" value="Corporative">
                      <label class="form-check-label" >Corporative</label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="ownership" value="Joint">
                      <label class="form-check-label" >Joint</label>
                    </div>
                </div>
                <div class="alert alert-danger" id="ownershipErrorMsg" style="display:none"></div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <div class="form-group">
                <label for="cid">Applicant CID</label>
                <input type="number" oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);" class="form-control" id="cid" name="cid" maxlength="11" onkeypress="return isNumberKey(event)" value="{{application_details.CID}}">
            </div>
            <div class="alert alert-danger" id="cidErrorMsg" style="display:none"></div>
        </div>
        <div class="col-md-6">
            <div class="form-group">
                <label for="name">Name</label>
                <input type="text" class="form-control" id="name" name="Name" value="{{application_details.Name_Owner}}">
            </div>
            <div class="alert alert-danger" id="nameErrorMsg" style="display:none"></div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <div class="form-group">
                <label for="contactNumber">Contact Number</label>
                <input type="number" class="form-control" id="contactNumber" oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"  name="contactNumber" maxlength="8" onkeypress="return isNumberKey(event)" value="{{application_details.Contact_No}}">
            </div>
            <div class="alert alert-danger" id="contactNumberErrorMsg" style="display:none"></div>
        </div>
        <div class="col-md-6">
            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" class="form-control" id="email" name="email" value="{{application_details.Email}}">
            </div>
            <div class="alert alert-danger" id="emailErrorMsg" style="display:none"></div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <div class="form-group">
                <label for="dzongkhag">Dzongkhag</label>
                <select class="form-control" name="dzongkhag"  id="dzongkhag" onchange="getGewog(this.value),getLocation(this.value)">
                    <option value="">--SELECT DZONGKHAG--</option>
                    {% for dzongkhag in dzongkhag %}
                            <option value="{{ dzongkhag.Dzongkhag_Code }}">{{ dzongkhag.Dzongkhag_Name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="alert alert-danger" id="dzongkhagErrorMsg" style="display:none"></div>
        </div>
        <div class="col-md-6">
            <div class="form-group">
                <label for="gewog">Gewog</label>
                <select class="form-control" name="gewog" id="gewog" onchange="getVillage(this.value)">
                    <option value="">--SELECT GEWOG--</option>
                    {% for gewog in gewog %}
                            <option value="{{ gewog.Gewog_Code }}">{{ gewog.Gewog_Name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="alert alert-danger" id="gewogErrorMsg" style="display:none"></div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <div class="form-group">
                <label for="village">Village</label>
                 <select class="form-control" name="village" id="village">
                    <option value="">--SELECT VILLAGE--</option>
                    {% for village in village %}
                            <option value="{{ village.Village_Code }}">{{ village.Village_Name }}</option>
                    {% endfor %}
                 </select>
            </div>
            <div class="alert alert-danger" id="villageErrorMsg" style="display:none"></div>
        </div>
        <div class="col-md-6">
            <div class="form-group">
                <label for="location">Location</label>
                 <select class="form-control" name="location_code"  id="location">
                    <option value="">--SELECT LOCATION--</option>
                    {% for location in location %}
                            <option value="{{ location.Location_Code }}">{{ location.Location_Name }}</option>
                    {% endfor %}
                 </select>
            </div>
            <div class="alert alert-danger" id="locationErrorMsg" style="display:none"></div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <div class="form-group">
            <label>Clearance from the local government/community/house owner</label>
                <div class="form-check" id="clearance">
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="clearance" value="Yes">
                      <label class="form-check-label">Yes</label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="clearance" value="No">
                      <label class="form-check-label">No</label>
                    </div>
                </div>
                <div class="alert alert-danger" id="clearanceErrorMsg" style="display:none"></div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-group">
            <label>Any proceedings by BAFRA in the past suspension or cancellation or  withdrawal of approvals</label>
                <div class="form-check" id="proceeding" name="proceeding">
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="proceeding" value="Yes">
                      <label class="form-check-label">Yes</label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="proceeding" value="No">
                      <label class="form-check-label">No</label>
                    </div>
                </div>
                <div class="alert alert-danger" id="proceedingErrorMsg" style="display:none"></div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <div class="form-group">
                <label for="proceedingReason">If yes, state reason?</label>
                <input type="text" class="form-control" id="proceedingReason" name="proceedingReason" value="{{application_details.Reason_Suspension}}">
            </div>
            <div class="alert alert-danger" id="proceedingReasonErrorMsg" style="display:none"></div>
        </div>
        <div class="col-md-6">
            <div class="form-group">
                <label for="inspectionDate">Request Date for Inspection</label>
                 <input type="date" name="inspectionDate" id="inspectionDate" class="form-control date-picker flatpickr-input active" value="{{application_details.Desired_Inspection_Date}}">
            </div>
            <div class="alert alert-danger" id="inspectionDateErrorMsg" style="display:none"></div>
        </div>
    </div>
    <div class="card-action">
        <button type="button" class="btn btn-primary" value="Submit" onclick="saveform(this.form)">Update</button>
    </div>
{% endfor %}
<script>
function saveform(form)
    {
        var shopName = $('#shopName').val();
        var cid = $('#cid').val();
        var name = $('#name').val();
        var contactNumber = $('#contactNumber').val();
        var email = $('#email').val();
        var dzongkhag = $('#dzongkhag').val();
        var gewog = $('#gewog').val();
        var village = $('#village').val();
        var location = $('#location').val();
        var clearance = $('#clearance').val();
        var proceeding = $('#proceeding').val();
        var proceedingReason = $('#proceedingReason').val();
        var inspectionDate = $('#inspectionDate').val();
        var cidCount = $('#cid').val().length;
        var number_count = $('#contactNumber').val().length;

        if ((form.scope[0].checked == false) && (form.scope[1].checked == false) && (form.scope[2].checked == false))
        {
            $('#scopeErrorMsg').html("Select Scope.");
            $('#scopeErrorMsg').show();
            $('#scopeErrorMsg').delay(2000).fadeOut('slow');
            return false;
        }

        else if ((form.purpose[0].checked == false) && (form.purpose[1].checked == false))
        {
            $('#purposeErrorMsg').html("Select Purpose.");
            $('#purposeErrorMsg').show();
            $('#purposeErrorMsg').delay(2000).fadeOut('slow');
        }
        else if(shopName == "")
        {
            $('#shopNameErrorMsg').html("Enter Name of the Meat Shop.");
            $('#shopNameErrorMsg').show();
            $('#shopNameErrorMsg').delay(2000).fadeOut('slow');
        }
        else if ((form.ownership[0].checked == false) && (form.ownership[1].checked == false) && (form.ownership[2].checked == false) && (form.ownership[3].checked == false))
        {
            $('#ownershipErrorMsg').html("Select Ownership.");
            $('#ownershipErrorMsg').show();
            $('#ownershipErrorMsg').delay(2000).fadeOut('slow');
        }
        else if(cid == "")
        {
            $('#cidErrorMsg').html("Enter CID Number.");
            $('#cidErrorMsg').show();
            $('#cidErrorMsg').delay(2000).fadeOut('slow');
        }
        else if(name == "")
        {
            $('#nameErrorMsg').html("Enter Name .");
            $('#nameErrorMsg').show();
            $('#nameErrorMsg').delay(2000).fadeOut('slow');
        }
        else if(contactNumber == "")
        {
            $('#contactNumberErrorMsg').html("Enter Contact Number.");
            $('#contactNumberErrorMsg').show();
            $('#contactNumberErrorMsg').delay(2000).fadeOut('slow');
        }
        else if(email == "")
        {
            $('#emailErrorMsg').html("Enter Contact Number.");
            $('#emailErrorMsg').show();
            $('#emailErrorMsg').delay(2000).fadeOut('slow');
        }
        else if(dzongkhag == "")
        {
            $('#dzongkhagErrorMsg').html("Select Dzongkhag.");
            $('#dzongkhagErrorMsg').show();
            $('#dzongkhagErrorMsg').delay(2000).fadeOut('slow');
        }
        else if(gewog == "")
        {
            $('#gewogErrorMsg').html("Select Gewog.");
            $('#gewogErrorMsg').show();
            $('#gewogErrorMsg').delay(2000).fadeOut('slow');
        }
        else if(village == "")
        {
            $('#villageErrorMsg').html("Select Village.");
            $('#villageErrorMsg').show();
            $('#villageErrorMsg').delay(2000).fadeOut('slow');
        }
        else if(location == "")
        {
            $('#locationErrorMsg').html("Select Location.");
            $('#locationErrorMsg').show();
            $('#locationErrorMsg').delay(2000).fadeOut('slow');
        }
        else if ((form.clearance[0].checked == false) && (form.clearance[1].checked == false))
        {
            $('#clearanceErrorMsg').html("Select Clearance.");
            $('#clearanceErrorMsg').show();
            $('#clearanceErrorMsg').delay(2000).fadeOut('slow');
        }
        else if ((form.proceeding[0].checked == false) && (form.proceeding[1].checked == false))
        {
            $('#proceedingErrorMsg').html("Select Proceeding.");
            $('#proceedingErrorMsg').show();
            $('#proceedingErrorMsg').delay(2000).fadeOut('slow');
        }
        else if(inspectionDate == "")
        {
            $('#inspectionDateErrorMsg').html("Select Date.");
            $('#inspectionDateErrorMsg').show();
            $('#inspectionDateErrorMsg').delay(2000).fadeOut('slow');
        }
        else if(cidCount < 11)
        {
            $('#cidErrorMsg').html("Cannot Be Less Than Eleven Digits.");
            $('#cidErrorMsg').show();
            setTimeout('hideStatus("cidErrorMsg")',2000);
        }
        else if(number_count < 8)
        {
            $('#contactNumberErrorMsg').html("Cannot Be Less Than Eight.");
            $('#contactNumberErrorMsg').show();
            setTimeout('hideStatus("contactNumberErrorMsg")',2000);
        }
        else
        {
            $.ajax({
                type : "POST",
                url : "{% url 'save_meat_shop_clearance' %}",
                data : $('#meatShopClearanceForm').serialize(),
                success : function(data) {
                    $('#applicationNo').val(data.applNo);
                    $('#meatshop_applicationNo').val(data.applNo);
                    $('#pills-profile-file').tab('show');
                }
            });
        }
    }

function loadPageDetails(appId)
{
    var appid = $('#applicationNo').val();
    $.ajax({
        type : "GET",
        url : "{% url 'load_page_details' %}",
        data :{'application_id':appid},
        success : function(response)
        {
            $('#applicant_details').html(response);
        }
    });
}
function load_attachment_details(appId)
{
    var appid = $('#applicationNo').val();
    $.ajax({
        type : "GET",
        url : "{% url 'load_attachment_details' %}",
        data :{'application_id':appid},
        success : function(response)
        {
            $('#fileAttach').html(response);
        }
    });
}

function getGewog(dzongkhag_id)
{
    $.ajax({
        type : "GET",
        url : "{% url 'load_gewog' %}",
        data :{'dzongkhag_id':dzongkhag_id},
        success : function(data)
        {
            $('#gewog').html(data);
        }
    });
}

function getVillage(gewog_id)
{
    $.ajax({
        type : "GET",
        url : "{% url 'load_village' %}",
        data :{'gewog_id':gewog_id},
        success : function(data)
        {
            $('#village').html(data);
        }
    });
}

function getLocation(dzongkhag_id)
{
    $.ajax({
        type : "GET",
        url : "{% url 'load_location' %}",
        data :{'dzongkhag_id':dzongkhag_id},
        success : function(data) {
            $('#location').html(data);
        }
    });
}

function updateDetails()
{
    $.ajax({
        type : "POST",
        url : "{% url 'update_details' %}",
        data : $('#permitForm').serialize(),
        success : function(response)
        {
            $('.wrapper').html(response);
            $('#pills-tab a:last').tab('show');
        }
    });
}

function save_attachment()
{
    var fileName = document.getElementById('document').files[0].name;
    var fd = new FormData();
    var file = document.getElementById('document').files[0];
    fd.append('document', file);
    token_value=$("input[name=csrfmiddlewaretoken]").val();
    $.ajaxSetup
    ({
        beforeSend: function(xhr, settings)
        {
            xhr.setRequestHeader("X-CSRFToken", token_value);
        }
    });
        $.ajax({
        type : "POST",
        url : "{% url 'save_meat_shop_file' %}",
        data : fd,
        dataType: 'json',
        contentType: false,
        processData: false,
        success : function(data)
        {
            if (data.form_is_valid)
            {
                var appNo = $('#applicationNo').val();

                $.ajax
                ({
                    type : "POST",
                    url : "{% url 'add_meat_shop_file_name' %}",
                    data : {'appNo':appNo , 'filename':fileName},
                    success : function(responseText)
                    {
                        $('#attachmentModal').modal('hide');
                        $('#file-attachment').html(responseText);
                        $('.modal-backdrop').remove();
                    }
                });
            }else
            {
                $('#fileErrorMsg').html("File Already Exists With Same Name. Please Upload Another File");
                $('#fileErrorMsg').show();
                $('#fileErrorMsg').delay(2000).fadeOut('slow');
            }
        }
    });

}


</script>
{% endblock %}