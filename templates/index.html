<!DOCTYPE html>
{% load static %}
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6 lt8"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7 lt8"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8 lt8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->

    <head>
        <meta charset="UTF-8" />
        <!-- <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">  -->
        <title>BBFSS| Bhutan Biosecurity and Food Safety System</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="Login and Registration Form with HTML5 and CSS3" />
        <meta name="keywords" content="html5, css3, form, switch, animation, :target, pseudo-class" />
        <meta name="author" content="Codrops" />
        <link rel="shortcut icon" href="../favicon.ico">
        <link href="https://fonts.googleapis.com/css?family=Roboto:300,400&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="{% static 'assets/css/owl.carousel.min.css' %}">
        <link rel="stylesheet" href="{% static 'assets/css/bootstrap1.min.css' %}">
        <link rel="stylesheet" href="{% static 'css/style3.css' %}">
        <link rel="stylesheet" type="text/css" href="{% static 'css/animate-custom.css' %}" />
        <link rel="stylesheet" type="text/css" href="{% static 'css/demo.css' %}" />
        <link href="{% static 'styles/font-awesome/css/font-awesome.min.css' %}" rel="stylesheet">
        <style>
            h4 {
                font-size: 18px;
                color: rgb(6, 106, 117);
                padding: 2px 0 10px 0;
                font-family: 'Georgia';
                font-weight: bold;
                text-align: center;
                padding-bottom: 0px;
            }
            h4:after {
                content: ' ';
                display: block;
                width: 100%;
                height: 2px;
                margin-top: 10px;
                background: -moz-linear-gradient(left, rgba(147,184,189,0) 0%, rgba(147,184,189,0.8) 20%, rgba(147,184,189,1) 53%, rgba(147,184,189,0.8) 79%, rgba(147,184,189,0) 100%);
                background: -webkit-gradient(linear, left top, right top, color-stop(0%,rgba(147,184,189,0)), color-stop(20%,rgba(147,184,189,0.8)), color-stop(53%,rgba(147,184,189,1)), color-stop(79%,rgba(147,184,189,0.8)), color-stop(100%,rgba(147,184,189,0)));
                background: -webkit-linear-gradient(left, rgba(147,184,189,0) 0%,rgba(147,184,189,0.8) 20%,rgba(147,184,189,1) 53%,rgba(147,184,189,0.8) 79%,rgba(147,184,189,0) 100%);
                background: -o-linear-gradient(left, rgba(147,184,189,0) 0%,rgba(147,184,189,0.8) 20%,rgba(147,184,189,1) 53%,rgba(147,184,189,0.8) 79%,rgba(147,184,189,0) 100%);
                background: -ms-linear-gradient(left, rgba(147,184,189,0) 0%,rgba(147,184,189,0.8) 20%,rgba(147,184,189,1) 53%,rgba(147,184,189,0.8) 79%,rgba(147,184,189,0) 100%);
                background: linear-gradient(left, rgba(147,184,189,0) 0%,rgba(147,184,189,0.8) 20%,rgba(147,184,189,1) 53%,rgba(147,184,189,0.8) 79%,rgba(147,184,189,0) 100%);
            }
            a {
                display: inline-block;
                font-weight: bold;
                background: rgb(247, 248, 241);
                padding: 0px 6px;
                color: rgb(29, 162, 193);
                margin-left: 10px;
                text-decoration: none;
                -webkit-border-radius: 4px;
                -moz-border-radius: 4px;
                border-radius: 4px;
                border: 1px solid rgb(203, 213, 214);
                -webkit-transition: all 0.4s linear;
                -moz-transition: all 0.4s linear;
                -o-transition: all 0.4s linear;
                -ms-transition: all 0.4s linear;
                transition: all 0.4s linear;
                font-family: 'Georgia';
            }
            p.button input{
                width: 30%;
                cursor: pointer;
                background: rgb(61, 157, 179);
                padding: 2px 0px;
                font-family: 'Georgia';
                color: #fff;
                font-size: 15px;
                border: 1px solid rgb(28, 108, 122);
                margin-bottom: 10px;
                text-shadow: 0 1px 1px rgb(0 0 0 / 50%);
                -webkit-border-radius: 3px;
                -moz-border-radius: 3px;
                border-radius: 3px;
                -webkit-box-shadow: 0px 1px 6px 4px rgb(0 0 0 / 7%) inset, 0px 0px 0px 3px rgb(254 254 254), 0px 5px 3px 3px rgb(210 210 210);
                -moz-box-shadow: 0px 1px 6px 4px rgba(0, 0, 0, 0.07) inset, 0px 0px 0px 3px rgb(254, 254, 254), 0px 5px 3px 3px rgb(210, 210, 210);
                box-shadow: 0px 1px 6px 4px rgb(0 0 0 / 7%) inset, 0px 0px 0px 3px rgb(254 254 254), 0px 5px 3px 3px rgb(210 210 210);
                -webkit-transition: all 0.2s linear;
                -moz-transition: all 0.2s linear;
                -o-transition: all 0.2s linear;
                transition: all 0.2s linear;
            }
            .btn .bi {
                position: relative;
                top: -2px;
            }
            .me-2 {
                margin-right: 0.1rem !important;
            }
            img, svg {
                vertical-align: middle;
            }
        </style>
    </head>
    <body>
    <header>
        <img src="{% static 'assets/img/banner.png' %}" class="img-fluid mx-auto d-block" alt="Responsive image" style="background:center;max-width:100%">
        <div class="float-right">
            <a href="{% url 'apply_complaint_form' %}" class="btn btn-sm btn-info">
                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-receipt" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path fill-rule="evenodd" d="M1.92.506a.5.5 0 0 1 .434.14L3 1.293l.646-.647a.5.5 0 0 1 .708 0L5 1.293l.646-.647a.5.5 0 0 1 .708 0L7 1.293l.646-.647a.5.5 0 0 1 .708 0L9 1.293l.646-.647a.5.5 0 0 1 .708 0l.646.647.646-.647a.5.5 0 0 1 .708 0l.646.647.646-.647a.5.5 0 0 1 .801.13l.5 1A.5.5 0 0 1 15 2v12a.5.5 0 0 1-.053.224l-.5 1a.5.5 0 0 1-.8.13L13 14.707l-.646.647a.5.5 0 0 1-.708 0L11 14.707l-.646.647a.5.5 0 0 1-.708 0L9 14.707l-.646.647a.5.5 0 0 1-.708 0L7 14.707l-.646.647a.5.5 0 0 1-.708 0L5 14.707l-.646.647a.5.5 0 0 1-.708 0L3 14.707l-.646.647a.5.5 0 0 1-.801-.13l-.5-1A.5.5 0 0 1 1 14V2a.5.5 0 0 1 .053-.224l.5-1a.5.5 0 0 1 .367-.27zm.217 1.338L2 2.118v11.764l.137.274.51-.51a.5.5 0 0 1 .707 0l.646.647.646-.646a.5.5 0 0 1 .708 0l.646.646.646-.646a.5.5 0 0 1 .708 0l.646.646.646-.646a.5.5 0 0 1 .708 0l.646.646.646-.646a.5.5 0 0 1 .708 0l.646.646.646-.646a.5.5 0 0 1 .708 0l.509.509.137-.274V2.118l-.137-.274-.51.51a.5.5 0 0 1-.707 0L12 1.707l-.646.647a.5.5 0 0 1-.708 0L10 1.707l-.646.647a.5.5 0 0 1-.708 0L8 1.707l-.646.647a.5.5 0 0 1-.708 0L6 1.707l-.646.647a.5.5 0 0 1-.708 0L4 1.707l-.646.647a.5.5 0 0 1-.708 0l-.509-.51z"></path>
                  <path fill-rule="evenodd" d="M3 4.5a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5zm8-6a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5z"></path>
                </svg>&nbsp;
                Complaint
            </a>
            <a href="{% static '/assets/manual/BBFS_UserManual.pdf' %}" class="btn btn-sm btn-danger" download="{% static 'assets/manual/BBFS_UserManual.pdf' %}">
                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-file-earmark-arrow-down me-2" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path d="M4 0h5.5v1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4.5h1V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2z"></path>
                  <path d="M9.5 3V0L14 4.5h-3A1.5 1.5 0 0 1 9.5 3z"></path>
                  <path fill-rule="evenodd" d="M8 6a.5.5 0 0 1 .5.5v3.793l1.146-1.147a.5.5 0 0 1 .708.708l-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 1 1 .708-.708L7.5 10.293V6.5A.5.5 0 0 1 8 6z"></path>
                </svg>&nbsp;
                User Manual
            </a>
        </div>
    </header>
    <br>
    <hr>
    <div class="container">
        <div class="row">
            <div class="col-md-7">
                <img src="{% static 'assets/img/background1.jpg' %}" alt="Image" class="img-fluid">
            </div>
            <div class="col-md-5  mt-2">
                <div class="row justify-content-center">
                    <div class="card" style="width: 30rem;">
                        <div class="card-body">
                            <div id="to_login" class="animate form">
                                <form action="{% url 'login' %}" id="loginForm" method="post">
                                    {% csrf_token %}
                                    <h4>Login</h4>
                                    {% if message %}
                                        <div class="alert alert-danger" id="login_error">{{ message }}</div>
                                    {% endif %}
                                    <div class="col-md-12">
                                        <div class="row mt-2">
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <input type="email" class="form-control" id="username" name="username" placeholder="Your Email" autocomplete="off" required="required">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <input type="password" class="form-control" id="password" name="password"  placeholder="Your Password" autocomplete="off" required="required">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card-action">
                                            <p class="login button">
                                                <input type="submit" value="Login">
                                            </p>
                                            <hr>
                                            <div class="row float-right">
                                                <a href="{% url 'register' %}" class="to_register">Client Register</a>&nbsp;&nbsp;
                                                <a href="#" class="to_register" onclick="to_register_div()">Forgot Password ?</a>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div id="to_register" class="animate form" style="display:none">
                                <form action="{% url 'login' %}" id="forgot_password_form" method="post">
                                    {% csrf_token %}
                                    <h4>Forgot Password</h4>

                                    <div class="col-md-12">
                                        <div class="row mt-2">
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <input type="email" name="email" class="form-control" id="email" required="required" placeholder="Your Email"  onchange="validateemailId(this.value)" onblur="getSecurityQuestion(this.value)"/>
                                                </div>
                                                <div class="alert" id="emailErrorMsg" style="display:none"></div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <select class="form-control" name="security" id="security" onchange="getAnswer(this.value)">
                                                        <option value="">SELECT SECURITY QUESTION</option>
                                                        {% for security in security %}
                                                            <option value="{{ security.Question_Id }}">{{ security.Question }}</option>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                                <div class="alert" id="securityErrorMsg" style="display:none"></div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <input id="answer" name="answer"  class="form-control" required="required"  placeholder="Security Answer" type="text" />
                                                    <input type="hidden" class="form-control form-control-md" id="securityAnswer">
                                                </div>
                                                <div class="alert" id="AnswerErrorMsg" style="display:none"></div>
                                            </div>
                                        </div>
                                        <div id="sucessMsg" class="alert alert-success" role="alert" style="display:none;">
                                            Your password was successfully reset..Please Check Your Email
                                        </div>
                                        <div class="card-action">
                                            <p class="signin button">
                                                <input type="button" id="submit_button" value="Submit"  onclick="update_password()"/>
                                            </p>
                                            <hr>
                                            <div class="row float-right">
                                                Already a member ?
                                                <a href="#" class="to_register" onclick="to_login_div()"> Go and log in </a>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div clas="row">
        <div class="text-center">
          <p class="footer">©  BAFRA- Bhutan Biosecurity and Food Safety System (BBFSS), 2021. All Rights Reserved.</p>
        </div>
    </div>

    </body>
</html>
<script src="{% static 'assets/bower_components/jquery/dist/jquery.min.js' %}"></script>
<script>
var spinner = $('#loader');
spinner.hide();




function getGewog(dzongkhag_id)
{
    $.ajax({
        type : "GET",
        url : "{% url 'load_gewog' %}",
        data :{'dzongkhag_id':dzongkhag_id},
        success : function(data) {
            $('#gewog').html(data);
        }
    });
}

function getVillage(gewog_id)
{
    $.ajax({
        type : "GET",
        url : "{% url 'load_village' %}",
        data :{'gewog_id':gewog_id},
        success : function(data) {
            $('#village').html(data);
        }
    });
}

function getRegistrationForm()
{
    $.ajax({
        type : "GET",
        url : "{% url 'register' %}",
        success : function(data) {
            $('#regDiv').html(data);
        }
    });
}

function update_password()
    {

        var uid = $('#email').val();
        var answer = $('#answer').val();
        var security = $('#security').val();
        var answerForm =  $('#securityAnswer').val();

        if(uid == "")
        {
            $('#emailErrorMsg').html("Email Is Required");
            $('#emailErrorMsg').show();
            $('#email').focus();
            $('#emailErrorMsg').delay(2000).fadeOut('slow');
        }
        else if(security == "")
        {
            $('#securityErrorMsg').html("Select Security Question");
            $('#securityErrorMsg').show();
            $('#security').focus();
            $('#securityErrorMsg').delay(2000).fadeOut('slow');
        }
        else if(answer == "")
        {
            $('#AnswerErrorMsg').html("Enter Your Security Questions Answer");
            $('#AnswerErrorMsg').show();
            $('#answer').focus();
            $('#AnswerErrorMsg').delay(2000).fadeOut('slow');
        }
        else
        {
            var enteredAnswer = $('#answer').val();
            if(answerForm.toLowerCase() == enteredAnswer.toLowerCase())
            {
                $('#AnswerErrorMsg').html("Please Wait..");
                $('#AnswerErrorMsg').show();
                $('#AnswerErrorMsg').delay(3000).fadeOut('slow');
                $('#submit_button').hide();
                $.ajax({
                    type: 'POST',
                    url : "{% url 'update_password' %}",
                    data : $('#forgot_password_form').serialize(),
                    success: function(data)
                    {
                        $('#sucessMsg').show();
                        $('#sucessMsg').delay(2000).fadeOut('slow');
                        $('#submit_button').show();
                        setTimeout('location.reload()',3000);
                    }
                });
            }
            else
            {
                $('#AnswerErrorMsg').html("The answer you entered does not match your previous answer, please verify and try again else contact administrator");
                $('#AnswerErrorMsg').show();
                $('#AnswerErrorMsg').delay(2000).fadeOut('slow');
            }
        }
    }

    function validateemailId(emailId)
    {
        var pattern=/[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,3}$/;
        var no=emailId.match(pattern);

        if(no==null)
        {
            $('#emailErrorMsg').html("<span class='alert alert-danger'>The email Id is Not valid");
            $('#email').val("");
            $('#emailErrorMsg').show();
            $('#emailErrorMsg').delay(2000).fadeOut('slow');
        }else{
         $('#emailErrorMsg').hide();
        }

    }

    function getSecurityQuestion(uid)
     {
        if(uid == "")
        {
            $('#emailErrorMsg').html("Email Is Required.");
            $('#emailErrorMsg').show();
            $('#emailErrorMsg').delay(2000).fadeOut('slow');
        }
        else
        {
            $.ajax({
                type : "GET",
                url : "{% url 'load_security_question' %}",
                data :{'email':uid},
                success : function(data)
                {
                    $('#security').html(data);
                }
            });
        }
     }

    function getAnswer(questionId)
    {
        var uid = $('#email').val();
        $.ajax({
            async: false,
            type: 'POST',
            url : "{% url 'get_security_answer' %}",
            data :{'questionId':questionId, 'email':uid,  csrfmiddlewaretoken: '{{ csrf_token }}'},
            success: function(data)
            {
                $('#securityAnswer').val(data.answer);
            }
        });
    }

    function to_register_div()
    {
        $('#to_register').show();
        $('#to_login').hide();
    }

    function to_login_div()
    {
        $('#to_register').hide();
        $('#to_login').show();
    }
</script>